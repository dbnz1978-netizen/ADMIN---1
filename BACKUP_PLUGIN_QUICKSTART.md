# Плагин резервного копирования - Краткое руководство

## Описание

Плагин для создания полной резервной копии сайта с возможностью развертывания на новом хостинге.

## Быстрый старт

### 1. Установка плагина

1. Перейдите в **Админ-панель** → **Плагины**
2. Найдите плагин **"Система резервного копирования"**
3. Нажмите кнопку **"Установить"**
4. После установки нажмите кнопку **"Включить"** (если плагин не включен автоматически)

### 2. Создание резервной копии

1. В боковом меню выберите **"Резервное копирование"** → **"Создать резервную копию"**
2. Выберите нужные таблицы базы данных (по умолчанию выбраны все)
3. Выберите нужные папки (по умолчанию выбраны все)
4. Нажмите кнопку **"Создать резервную копию"**
5. Дождитесь завершения процесса
6. Нажмите кнопку **"Скачать архив"**

### 3. Восстановление на новом хостинге

1. Загрузите скачанный архив на новый хостинг
2. Распакуйте архив в корневую директорию сайта
3. Откройте в браузере файл **install.php**
4. Введите данные для подключения к базе данных:
   - Хост базы данных (обычно `localhost`)
   - Имя базы данных
   - Пользователь базы данных
   - Пароль базы данных
5. Нажмите кнопку **"Установить сайт"**
6. После успешной установки перейдите в админ-панель
7. **ВАЖНО:** Удалите файл `install.php` из корневой директории сайта

## Что входит в резервную копию

### База данных
- Все выбранные таблицы со структурой и данными
- SQL дамп в формате MySQL

### Файлы и папки
- Все выбранные папки со всем содержимым
- Папка `admin` всегда включается автоматически

### Дополнительные файлы
- `install.php` - установщик с Bootstrap интерфейсом
- `README.txt` - инструкция по установке

## Особенности

### Автоматическое включение папки admin
Папка `admin` всегда включается в резервную копию автоматически, даже если вы её не выбрали вручную.

### Безопасность
- CSRF защита для всех форм
- Валидация путей для предотвращения path traversal атак
- Валидация имён таблиц для предотвращения SQL инъекций
- Доступ только для администраторов (author='admin')

### Хранение резервных копий
Все резервные копии сохраняются в директории `../backups` (выше корня сайта) с именами вида:
```
backup_2026-02-12_14-30-45.zip
```

## Системные требования

### На текущем сервере
- PHP 7.4 или выше
- Расширение PHP: PDO, MySQL, ZIP
- Права на запись в родительскую директорию (для создания `../backups`)

### На новом сервере (для установки)
- PHP 7.4 или выше
- Расширение PHP: PDO, MySQL
- MySQL/MariaDB база данных
- Права на запись в корневую директорию

## Рекомендации

### Перед созданием резервной копии
1. Убедитесь, что на сервере достаточно свободного места
2. Проверьте, что все нужные таблицы и папки выбраны
3. Если база данных очень большая, создание резервной копии может занять несколько минут

### После создания резервной копии
1. Скачайте архив на свой компьютер
2. Сохраните резервную копию в надёжном месте (облако, внешний диск)
3. Регулярно создавайте новые резервные копии (рекомендуется раз в неделю)
4. Периодически удаляйте старые резервные копии с сервера, чтобы освободить место

### При восстановлении
1. Убедитесь, что на новом сервере установлен MySQL/MariaDB
2. Создайте пустую базу данных или используйте существующую
3. Запишите данные для подключения к базе данных
4. После успешной установки обязательно удалите файл `install.php`

## Возможные проблемы

### "Не удалось создать ZIP архив"
**Причина:** Не установлено расширение PHP ZIP  
**Решение:** Установите расширение ZIP на сервере

### "Не удалось создать временную директорию"
**Причина:** Нет прав на запись в родительскую директорию  
**Решение:** Установите права 755 на директорию `../backups`

### "Ошибка при экспорте базы данных"
**Причина:** Проблема с подключением к базе данных или недостаточно прав  
**Решение:** Проверьте права пользователя базы данных

### Установщик не открывается
**Причина:** Файл `install.php` не был распакован или не загружен на сервер  
**Решение:** Убедитесь, что архив полностью распакован

### Ошибка "Не удалось подключиться к базе данных" при установке
**Причина:** Неверные данные для подключения к базе данных  
**Решение:** Проверьте правильность введённых данных (хост, имя БД, пользователь, пароль)

## Техническая поддержка

Если у вас возникли проблемы с использованием плагина:
1. Проверьте логи PHP на наличие ошибок
2. Убедитесь, что все системные требования выполнены
3. Попробуйте создать резервную копию с минимальным набором таблиц и папок
4. Обратитесь к руководству по тестированию (BACKUP_PLUGIN_TESTING.md)

## Ограничения

### Максимальный размер архива
Размер архива ограничен:
- Настройкой PHP `memory_limit`
- Настройкой PHP `max_execution_time`
- Свободным местом на диске

Для больших сайтов рекомендуется:
- Увеличить `memory_limit` до 512M или выше
- Увеличить `max_execution_time` до 300 секунд или выше

### Символические ссылки
Символические ссылки копируются как обычные файлы, а не как ссылки.

### Большие файлы
Файлы размером более 100 МБ могут вызвать проблемы при архивации. В таких случаях рекомендуется исключить папки с большими файлами.
